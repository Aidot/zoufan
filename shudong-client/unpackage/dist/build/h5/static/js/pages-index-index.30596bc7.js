(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-index"],{1410:function(t,e,i){"use strict";(function(t){var n=i("4ea4");i("99af"),i("fb6a"),i("e25e"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i("dad7"),s=n(i("8f18"));i("ee59");var o=n(i("e111")),c=n(i("9fd2")),u=n(i("3646")),r=(new c.default,new u.default),d=["评论区","超话"],l=["最新","陪伴","认知","安慰","鼓励"],v={components:{Note:o.default},data:function(){return{menus:d,labels:l,title:"Hello",page:1,label:0,keyword:"",since_id:0,before_id:0,getAction:"before",comments:[],TabCur:0,openid:"123",fan:1,mid:1,scrollLeft:0,showFavor:!1,note:{openid:null,id:null},isLoading:!1,loadmoreText:{contentdown:"",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"},scrollTop:0}},onLoad:function(){this.getStorageComments(),this.getAuth()},onPageScroll:function(t){this.scrollTop=t.scrollTop},onShow:function(){this.getStorageComments(),uni.getStorage({key:"newsTop",success:function(t){var e=setTimeout((function(){uni.pageScrollTo({scrollTop:t.data,duration:0}),clearTimeout(e)}),50)}})},filters:{formatScore:function(t){return(100*t).toFixed(0)+"%"},formateDateTime:function(t){return(0,s.default)(t).startOf("second").fromNow()},formateDateT:function(t){return(0,s.default)(t).format("YYYY-MM-DD HH:mm:ss")},labelBgcolor:function(t){var e="bg-red";switch(t){case"认知":e="bg-blue";break;case"安慰":e="bg-yellow";break;case"鼓励":e="bg-green";break;default:e="bg-orange"}return e}},methods:{getStorageComments:function(){var t=this;uni.getStorage({key:"comments",success:function(e){t.comments=e.data,t.before_id=t.comments.slice(-1)[0].mid},fail:function(){t.getComments()}})},visitWeibo:function(e,i){uni.setStorage({key:"comments",data:this.comments}),uni.setStorage({key:"newsTop",data:this.scrollTop,success:function(){t("log","成功了"," at pages/index/index.vue:235")},fail:function(){t("log","缓存失败了"," at pages/index/index.vue:238")}}),window.open("https://m.weibo.cn/u/"+e)},visitMblog:function(e){uni.setStorage({key:"comments",data:this.comments}),uni.setStorage({key:"newsTop",data:this.scrollTop,success:function(){t("log","成功了"," at pages/index/index.vue:252")},fail:function(){t("log","缓存失败了"," at pages/index/index.vue:255")}}),window.open("https://m.weibo.cn/detail/"+e)},chatWeibo:function(e){uni.setStorage({key:"newsTop",data:this.scrollTop,success:function(){t("log","成功了"," at pages/index/index.vue:265")},fail:function(){t("log","缓存失败了"," at pages/index/index.vue:268")}})},navFavor:function(){this.showFavor=!this.showFavor,this.before_id=0,this.page=1,this.comments=[],this.getComments()},searchBlur:function(){this.before_id=0,this.getComments()},getHistories:function(t){this.before_id=0,this.keyword=t,this.getComments()},sendWxMsg:function(e,i){t("log","group msg",i," at pages/index/index.vue:290");var n="sos"==e?"专家":"志愿者",s={action:e,id:i.id,openid:this.openid};uni.showModal({title:"提醒",content:"点击确定，消息将转发到"+n+"群。",success:function(t){t.confirm&&uni.request({url:a.API_WX_MSG,method:"POST",data:s,success:function(t){uni.showToast({title:t.data.message,icon:"none",duration:2e3})}})}})},tabSelect:function(t){this.showFavor=!1,this.TabCur=t.currentTarget.dataset.id,this.label=parseInt(this.TabCur),this.before_id=0,this.scrollLeft=100*(t.currentTarget.dataset.id-1),this.keyword="",this.comments=[],this.page=1;var e=0==this.TabCur?"/pages/index/index":"/pages/topics";uni.navigateTo({url:e})},getAuth:function(){var e=this;r.request({data:{do:"auth",action:"getinfo"},method:"post"}).then((function(i){e.openid=i.data.openid,e.mid=i.data.mid,e.fan=i.data.fan,t("log","[Auth]","openid",e.openid," at pages/index/index.vue:345")}))},getComments:function(){if(!this.isLoading){uni.showLoading({title:"加载中"});var e=this,i=this.openid,n=this.page,s=this.label,o=this.keyword,c=(this.since_id,this.before_id);e.isLoading=!0,uni.request({url:a.API_COMMENTS,data:{openid:i,size:20,label:s,keyword:o,page:n,before_id:c,action:this.showFavor?"favtors":null},success:function(i){if(200===i.statusCode){var a=i.data,s=(a.meta,a.list);e.comments=c>0?e.comments.concat(s):s,s.length>0&&(e.page=n+1),e.since_id=s[0].mid,e.before_id=s.slice(-1)[0].mid}else uni.showToast({title:"没有了",icon:"none",duration:1e3});t("log",e.before_id," at pages/index/index.vue:401"),e.isLoading=!1,uni.hideLoading(),uni.stopPullDownRefresh()},fail:function(e){t("log",e," at pages/index/index.vue:407")}})}},addNote:function(t){var e=this.note.id;this.note={openid:this.openid,id:e?null:t}},hideNote:function(){this.note={id:null}},addFavor:function(e,i){if(this.openid){var n=this.comments[i].favor,s=this.openid,o=this.mid,c=this;t("log","[Favor]",n,s," at pages/index/index.vue:429"),uni.request({method:"POST",url:a.API_FAVOR,data:{openid:s,mid:o,comment_id:e,action:n?"cancel":"add"},success:function(t){uni.showToast({title:t.data.message,icon:"none",duration:2e3}),c.comments[i].favor=!n}})}},onPullDownRefresh:function(){var e=this;t("log","下拉刷新"," at pages/index/index.vue:450"),this.page=1,this.before_id=0,uni.removeStorage({key:"comments",success:function(){e.comments=[],e.getComments()}})},onReachBottom:function(e){t("log","触底加载更多",this.page,this.before_id," at pages/index/index.vue:462"),uni.removeStorage({key:"comments"}),this.getComments()}}};e.default=v}).call(this,i("0de9")["log"])},1669:function(t,e,i){"use strict";var n=i("b7ec"),a=i.n(n);a.a},"531b":function(t,e,i){"use strict";var n;i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"padding-sm"},[i("v-uni-form",{on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.submitNote.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v("日期")]),i("v-uni-picker",{attrs:{mode:"date",value:t.date,start:t.date,end:"2030-01-01"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.DateChange.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"picker"},[t._v(t._s(t.date))])],1)],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v("时间")]),i("v-uni-picker",{attrs:{mode:"time",value:t.time,start:t.time,end:"24:00"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.TimeChange.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"picker"},[t._v(t._s(t.time))])],1)],1),i("v-uni-view",{staticClass:"cu-form-group"},[i("v-uni-view",{staticClass:"title"},[t._v("内容")]),i("v-uni-input",{attrs:{placeholder:"提醒事项",name:"content"}}),i("v-uni-text",{staticClass:"cuIcon-locationfill text-orange"})],1),i("v-uni-view",{staticClass:"justify-center margin"},[i("v-uni-view",{staticClass:"text-center"},[i("v-uni-button",{staticClass:"cu-btn line-green text-green",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.hideNote.apply(void 0,arguments)}}},[t._v("关闭")]),i("v-uni-button",{staticClass:"cu-btn bg-green margin-left",attrs:{"form-type":"submit"}},[t._v("提交")])],1)],1)],1)],1)],1)},s=[]},"561c":function(t,e,i){"use strict";i.r(e);var n=i("b90d"),a=i("9235");for(var s in a)"default"!==s&&function(t){i.d(e,t,(function(){return a[t]}))}(s);i("1669");var o,c=i("f0c5"),u=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,"bd547e4a",null,!1,n["a"],o);e["default"]=u.exports},"79cc":function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,'.uni-page-wrapper[data-v-bd547e4a]{height:auto!important}.page[data-v-bd547e4a]{height:100Vh;width:100vw}.padding-l-140[data-v-bd547e4a]{padding-left:%?140?%}.page.show[data-v-bd547e4a]{overflow:hidden}.text-content-box[data-v-bd547e4a]{padding:0 15px 0;font-size:16px;line-height:1.35;margin-bottom:10px}.VerticalNav.nav[data-v-bd547e4a]{width:%?200?%;white-space:normal}.VerticalNav.nav .cu-item[data-v-bd547e4a]{width:100%;text-align:center;background-color:#fff;margin:0;border:none;height:50px;position:relative}.VerticalNav.nav .cu-item.cur[data-v-bd547e4a]{background-color:#f1f1f1}.VerticalNav.nav .cu-item.cur[data-v-bd547e4a]::after{content:"";width:%?8?%;height:%?30?%;border-radius:%?10?% 0 0 %?10?%;position:absolute;background-color:currentColor;top:0;right:%?0?%;bottom:0;margin:auto}.VerticalBox[data-v-bd547e4a]{display:flex}.VerticalMain[data-v-bd547e4a]{background-color:#f1f1f1;flex:1}',""]),t.exports=e},9235:function(t,e,i){"use strict";i.r(e);var n=i("1410"),a=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},af43:function(t,e,i){"use strict";i.r(e);var n=i("f8bd"),a=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},b7ec:function(t,e,i){var n=i("79cc");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("4f06").default;a("6eeeb888",n,!0,{sourceMap:!1,shadowMode:!1})},b90d:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n}));var n={uniLoadMore:i("79d0").default},a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"page"},[i("v-uni-view",{staticClass:"cu-bar search bg-white solid-bottom"},[i("v-uni-view",{staticClass:"search-form round"},[i("v-uni-text",{staticClass:"cuIcon-search"}),i("v-uni-input",{attrs:{"adjust-position":!1,type:"text",placeholder:"关键词","confirm-type":"search"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.searchBlur.apply(void 0,arguments)}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),i("v-uni-view",{staticClass:"action margin-left"},[i("v-uni-text",{class:t.showFavor?"cuIcon-attentionfavor text-orange":"cuIcon-attentionfavor",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.navFavor()}}})],1)],1),i("v-uni-scroll-view",{staticClass:"bg-white nav",attrs:{"scroll-x":!0,"scroll-with-animatio":!0,"scroll-left":t.scrollLeft}},[i("v-uni-view",{staticClass:"flex text-center"},t._l(t.menus,(function(e,n){return i("v-uni-view",{key:n,staticClass:"cu-item flex-sub",class:0==n?"text-red cur":"",attrs:{"data-id":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.tabSelect.apply(void 0,arguments)}}},[t._v(t._s(e))])})),1)],1),i("v-uni-view",{staticClass:"cu-card dynamic"},t._l(t.comments,(function(e,n){return i("v-uni-view",{key:e.id,staticClass:"cu-item shadow"},[i("v-uni-view",{staticClass:"cu-list menu-avatar"},[i("v-uni-view",{staticClass:"cu-item padding-l-140"},[i("v-uni-view",{staticClass:"cu-avatar round lg",style:"background-image:url("+e.user.avatar+");",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.visitWeibo(e.user.id)}}}),i("v-uni-view",{staticClass:"flex-sub"},[i("v-uni-view",[e.user.gender?i("v-uni-text",{staticClass:"margin-right-sm",class:"f"==e.user.gender?"text-pink cuIcon-female":"text-blue cuIcon-male"}):t._e(),i("v-uni-text",{attrs:{selectable:"true"}},[t._v(t._s(e.user.name||e.user.id))])],1),i("v-uni-view",{staticClass:"text-gray text-sm flex justify-between"},[t._v(t._s(t._f("formateDateTime")(e.created_at)))])],1),i("v-uni-view",[i("v-uni-view",{staticClass:"flex p-xs text-center",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.sendWxMsg("group",e)}}},[i("v-uni-view",{staticClass:"padding-sm text-xl"},[i("v-uni-text",{staticClass:"cuIcon-wefill text-green",attrs:{title:"扩散"}}),i("v-uni-view",{staticClass:"text-xs text-gray"},[t._v("扩散")])],1)],1)],1)],1)],1),e.label?i("v-uni-view",{staticClass:"cu-capsule padding-lr radius margin-top-sm"},[i("v-uni-text",{staticClass:"cu-tag sm",class:t._f("labelBgcolor")(e.label)},[t._v(t._s(e.label))]),i("v-uni-text",{staticClass:"cu-tag sm bg-gray"},[t._v(t._s(t._f("formatScore")(e.label_score)))])],1):t._e(),i("v-uni-view",{staticClass:"text-content-box margin-top-sm"},[i("v-uni-text",{attrs:{selectable:"true"}},[t._v(t._s(e.text))])],1),e.comments&&e.comments.length>1?i("v-uni-view",{staticClass:"padding-lr radius"},t._l(e.comments,(function(n,a){return i("v-uni-view",{key:a,staticClass:"margin-top-sm"},[n.id!=e.id?i("v-uni-view",[i("v-uni-view",{staticClass:"text-grey text-xs margin-bottom-xs"},[i("v-uni-text",{staticClass:"cuIcon-time"}),t._v(t._s(t._f("formateDateTime")(n.created_at)))],1),i("v-uni-view",{staticClass:"text-gray"},[t._v(t._s(n.text))])],1):t._e()],1)})),1):t._e(),i("v-uni-view",{staticClass:"text-grey text-sm flex justify-center margin-bottom-sm"},[i("v-uni-view",{staticClass:"padding-sm",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.visitWeibo(e.user.id,e.id)}}},[i("v-uni-text",{staticClass:"cuIcon-weibo margin-right-xs"}),i("v-uni-text",[t._v("主页")])],1),i("v-uni-view",{staticClass:"padding-sm",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.getHistories(e.user.name)}}},[i("v-uni-text",{staticClass:"cuIcon-text margin-right-xs"}),i("v-uni-text",[t._v("记录")])],1),i("v-uni-view",{staticClass:"padding-sm",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.visitMblog(e.source_id)}}},[i("v-uni-text",{staticClass:"cuIcon-link margin-right-xs"}),i("v-uni-text",[t._v("来源")])],1),i("v-uni-view",{staticClass:"padding-sm",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.addFavor(e.id,n)}}},[i("v-uni-text",{staticClass:"cuIcon-attentionfavor margin-right-xs",class:e.favor?"text-red":""}),i("v-uni-text",[t._v("收藏")])],1),i("v-uni-view",{staticClass:"padding-sm",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.sendWxMsg("sos",e)}}},[i("v-uni-text",{staticClass:"cuIcon-noticefill text-red"}),i("v-uni-text",[t._v("告警")])],1)],1),t.note.id===e.id?i("Note",{attrs:{note:t.note},on:{hideNote:function(e){arguments[0]=e=t.$handleEvent(e),t.hideNote.apply(void 0,arguments)}}}):t._e()],1)})),1),i("uni-load-more",{attrs:{contentText:t.loadmoreText}})],1)},s=[]},e111:function(t,e,i){"use strict";i.r(e);var n=i("531b"),a=i("af43");for(var s in a)"default"!==s&&function(t){i.d(e,t,(function(){return a[t]}))}(s);var o,c=i("f0c5"),u=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,"60d358cc",null,!1,n["a"],o);e["default"]=u.exports},f8bd:function(t,e,i){"use strict";(function(t){var n=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(i("8f18")),s=i("dad7"),o={props:["note"],data:function(){return{date_start:(0,a.default)().format("YYYY-MM-DD"),time_start:(0,a.default)().format("HH:mm"),time:(0,a.default)().format("HH:mm"),date:(0,a.default)().format("YYYY-MM-DD"),content:""}},watch:{},methods:{submitNote:function(e){var i=e.detail.value,n=(0,a.default)(this.date+" "+this.time).unix();uni.request({url:s.API_NOTE_ADD,method:"POST",data:{time:n,openid:this.note.openid,comment_id:this.note.id,type:1,content:i.content},success:function(e){t("log",e," at pages/index/note.vue:72"),uni.showToast({title:e.data.message,icon:"none",duration:2e3}),this.$emit("hideNote")}})},hideNote:function(){this.$emit("hideNote")},TimeChange:function(t){this.time=t.detail.value},DateChange:function(e){this.date=e.detail.value,t("log",33,e," at pages/index/note.vue:90")},ContentChange:function(e){t("log",44,e.detail.value," at pages/index/note.vue:93"),this.content=e.detail.value}}};e.default=o}).call(this,i("0de9")["log"])}}]);