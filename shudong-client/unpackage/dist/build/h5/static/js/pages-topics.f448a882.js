(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-topics"],{"03ac":function(t,e,i){var n=i("2c13");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=i("4f06").default;o("00f69e60",n,!0,{sourceMap:!1,shadowMode:!1})},"2c13":function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,'.uni-page-wrapper[data-v-761b6ece]{height:auto!important}.text-content-box[data-v-761b6ece]{padding:0 15px 0;font-size:16px;line-height:1.35;margin-bottom:10px}.page[data-v-761b6ece]{height:100Vh;width:100vw}.padding-l-140[data-v-761b6ece]{padding-left:%?140?%}.page.show[data-v-761b6ece]{overflow:hidden}.VerticalNav.nav[data-v-761b6ece]{width:%?200?%;white-space:normal}.VerticalNav.nav .cu-item[data-v-761b6ece]{width:100%;text-align:center;background-color:#fff;margin:0;border:none;height:50px;position:relative}.VerticalNav.nav .cu-item.cur[data-v-761b6ece]{background-color:#f1f1f1}.VerticalNav.nav .cu-item.cur[data-v-761b6ece]::after{content:"";width:%?8?%;height:%?30?%;border-radius:%?10?% 0 0 %?10?%;position:absolute;background-color:currentColor;top:0;right:%?0?%;bottom:0;margin:auto}.VerticalBox[data-v-761b6ece]{display:flex}.VerticalMain[data-v-761b6ece]{background-color:#f1f1f1;flex:1}',""]),t.exports=e},"4b44":function(t,e,i){"use strict";i.r(e);var n=i("d243"),o=i("89ce");for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i("dc28");var s,c=i("f0c5"),r=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"761b6ece",null,!1,n["a"],s);e["default"]=r.exports},"6f2e":function(t,e,i){"use strict";(function(t){var n=i("4ea4");i("99af"),i("fb6a"),i("e25e"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i("dad7"),a=n(i("8f18"));i("ee59");var s=n(i("9fd2")),c=n(i("3646")),r=(new s.default,new c.default),u=["评论区","超话"],l=["评论区","超话"],d={components:{},data:function(){return{menus:u,labels:l,title:"Hello",page:1,label:0,keyword:"",since_id:0,before_id:0,getAction:"before",comments:[],TabCur:0,openid:"123",fan:1,mid:1,scrollLeft:0,showFavor:!1,note:{openid:null,id:null},isLoading:!1,loadmoreText:{contentdown:"",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"},scrollTop:0}},onLoad:function(){this.getStorageComments(),this.getAuth()},onPageScroll:function(t){this.scrollTop=t.scrollTop},onShow:function(){this.getStorageComments(),uni.getStorage({key:"newsTop",success:function(t){var e=setTimeout((function(){uni.pageScrollTo({scrollTop:t.data,duration:0}),clearTimeout(e)}),50)}})},filters:{formatScore:function(t){return(100*t).toFixed(0)+"%"},formateDateTime:function(t){return(0,a.default)(t).startOf("second").fromNow()},formateDateT:function(t){return(0,a.default)(t).format("YYYY-MM-DD HH:mm:ss")},labelBgcolor:function(t){var e="bg-red";switch(t){case"评论区":e="bg-blue";break;case"超话":e="bg-yellow";break;case"鼓励":e="bg-green";break;default:e="bg-orange"}return e}},methods:{getStorageComments:function(){var t=this;uni.getStorage({key:"comments",success:function(e){t.comments=e.data,t.before_id=t.comments.slice(-1)[0].mid},fail:function(){t.getComments()}})},visitWeibo:function(e,i){uni.setStorage({key:"comments",data:this.comments}),uni.setStorage({key:"newsTop",data:this.scrollTop,success:function(){t("log","成功了"," at pages/topics.vue:208")},fail:function(){t("log","缓存失败了"," at pages/topics.vue:211")}}),window.open("https://m.weibo.cn/u/"+e)},visitMblog:function(e){uni.setStorage({key:"comments",data:this.comments}),uni.setStorage({key:"newsTop",data:this.scrollTop,success:function(){t("log","成功了"," at pages/topics.vue:225")},fail:function(){t("log","缓存失败了"," at pages/topics.vue:228")}}),window.open("https://m.weibo.cn/detail/"+e)},chatWeibo:function(e){uni.setStorage({key:"newsTop",data:this.scrollTop,success:function(){t("log","成功了"," at pages/topics.vue:238")},fail:function(){t("log","缓存失败了"," at pages/topics.vue:241")}})},navFavor:function(){this.showFavor=!this.showFavor,this.before_id=0,this.page=1,this.comments=[],this.getComments()},searchBlur:function(){this.before_id=0,this.getComments(),uni.navigateTo({url:"?keyword="+this.keyword})},getHistories:function(t){this.before_id=0,this.keyword=t,this.getComments()},sendWxMsg:function(e,i){t("log","group msg",i," at pages/topics.vue:264");var n="sos"==e?"专家":"志愿者",a={action:e,id:i.id,openid:this.openid,type:"topic"};uni.showModal({title:"提醒",content:"点击确定，消息将转发到"+n+"群。",success:function(t){t.confirm&&uni.request({url:o.API_WX_MSG,method:"POST",data:a,success:function(t){uni.showToast({title:t.data.message,icon:"none",duration:2e3})}})}})},tabSelect:function(t){this.showFavor=!1,this.TabCur=t.currentTarget.dataset.id,this.label=parseInt(this.TabCur),this.before_id=0,this.scrollLeft=100*(t.currentTarget.dataset.id-1),this.keyword="",this.comments=[],this.page=1;var e=0==this.TabCur?"/pages/index/index":"/pages/topics";uni.navigateTo({url:e})},getAuth:function(){var e=this;r.request({data:{do:"auth",action:"getinfo"},method:"post"}).then((function(i){e.openid=i.data.openid,e.mid=i.data.mid,e.fan=i.data.fan,t("log","[Auth]","openid",e.openid," at pages/topics.vue:323")}))},getComments:function(){if(!this.isLoading){uni.showLoading({title:"加载中"});var e=this,i=this.openid,n=this.page,a=this.label,s=this.keyword,c=(this.since_id,this.before_id);e.isLoading=!0,uni.request({url:o.API_TOPICS,data:{openid:i,size:20,label:a,keyword:s,page:n,before_id:c,action:this.showFavor?"favtors":null},success:function(i){if(200===i.statusCode){var o=i.data,a=(o.meta,o.list);e.comments=c>0?e.comments.concat(a):a,a.length>0&&(e.page=n+1),e.since_id=a[0].mid,e.before_id=a.slice(-1)[0].mid}else uni.showToast({title:"没有了",icon:"none",duration:1e3});t("log",e.before_id," at pages/topics.vue:379"),e.isLoading=!1,uni.hideLoading(),uni.stopPullDownRefresh()},fail:function(e){t("log",e," at pages/topics.vue:385")}})}},addNote:function(t){var e=this.note.id;this.note={openid:this.openid,id:e?null:t}},hideNote:function(){this.note={id:null}},addFavor:function(e,i){if(this.openid){var n=this.comments[i].favor,a=this.openid,s=this.mid,c=this;t("log","[Favor]",n,a," at pages/topics.vue:407"),uni.request({method:"POST",url:o.API_FAVOR,data:{openid:a,mid:s,comment_id:e,action:n?"cancel":"add"},success:function(t){uni.showToast({title:t.data.message,icon:"none",duration:2e3}),c.comments[i].favor=!n}})}},onPullDownRefresh:function(){var e=this;t("log","下拉刷新"," at pages/topics.vue:428"),this.page=1,this.before_id=0,uni.removeStorage({key:"comments",success:function(){e.comments=[],e.getComments()}})},onReachBottom:function(e){t("log","触底加载更多",this.page,this.before_id," at pages/topics.vue:440"),uni.removeStorage({key:"comments"}),this.getComments()}}};e.default=d}).call(this,i("0de9")["log"])},"89ce":function(t,e,i){"use strict";i.r(e);var n=i("6f2e"),o=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},d243:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}));var n={uniLoadMore:i("79d0").default},o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"page"},[i("v-uni-view",{staticClass:"cu-bar search bg-white solid-bottom"},[i("v-uni-view",{staticClass:"search-form round"},[i("v-uni-text",{staticClass:"cuIcon-search"}),i("v-uni-input",{attrs:{"adjust-position":!1,type:"text",placeholder:"搜索超话","confirm-type":"search"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.searchBlur.apply(void 0,arguments)}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),i("v-uni-view",{staticClass:"action margin-left"},[i("v-uni-text",{class:t.showFavor?"cuIcon-attentionfavor text-orange":"cuIcon-attentionfavor",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.navFavor()}}})],1)],1),i("v-uni-scroll-view",{staticClass:"bg-white nav",attrs:{"scroll-x":!0,"scroll-with-animatio":!0,"scroll-left":t.scrollLeft}},[i("v-uni-view",{staticClass:"flex text-center"},t._l(t.menus,(function(e,n){return i("v-uni-view",{key:n,staticClass:"cu-item flex-sub",class:1==n?"text-red cur":"",attrs:{"data-id":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.tabSelect.apply(void 0,arguments)}}},[t._v(t._s(e))])})),1)],1),i("v-uni-view",{staticClass:"cu-card dynamic"},t._l(t.comments,(function(e,n){return i("v-uni-view",{key:e.id,staticClass:"cu-item shadow"},[i("v-uni-view",{staticClass:"cu-list menu-avatar"},[i("v-uni-view",{staticClass:"cu-item padding-l-140"},[i("v-uni-view",{staticClass:"cu-avatar round lg",style:"background-image:url("+e.user.avatar+");",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.visitWeibo(e.user.id)}}}),i("v-uni-view",{staticClass:"flex-sub"},[i("v-uni-view",[e.user.gender?i("v-uni-text",{staticClass:"margin-right-sm",class:"f"==e.user.gender?"text-pink cuIcon-female":"text-blue cuIcon-male"}):t._e(),i("v-uni-text",{attrs:{selectable:"true"}},[t._v(t._s(e.user.name||e.user.id))])],1),i("v-uni-view",{staticClass:"text-gray text-sm flex justify-between"},[t._v(t._s(t._f("formateDateTime")(e.created_at)))])],1),i("v-uni-view",[i("v-uni-view",{staticClass:"flex p-xs text-center",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.sendWxMsg("sos",e)}}},[i("v-uni-view",{staticClass:"padding-sm text-xl"},[i("v-uni-text",{staticClass:"cuIcon-notice text-red",attrs:{title:"告警"}}),i("v-uni-view",{staticClass:"text-xs text-gray"},[t._v("告警")])],1)],1)],1)],1)],1),i("v-uni-view",{staticClass:"text-content-box margin-top-sm padding-bottom-xl"},[i("v-uni-text",{attrs:{selectable:"true"}},[t._v(t._s(e.text))])],1),i("v-uni-view",{staticClass:"text-grey text-sm flex justify-center margin-bottom-sm"},[i("v-uni-view",{staticClass:"padding-sm",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.visitWeibo(e.user.id,e.id)}}},[i("v-uni-text",{staticClass:"cuIcon-weibo margin-right-xs"}),i("v-uni-text",[t._v("主页")])],1),i("v-uni-view",{staticClass:"padding-sm",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.getHistories(e.user.name)}}},[i("v-uni-text",{staticClass:"cuIcon-text margin-right-xs"}),i("v-uni-text",[t._v("记录")])],1),i("v-uni-view",{staticClass:"padding-sm",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.visitMblog(e.mid)}}},[i("v-uni-text",{staticClass:"cuIcon-link margin-right-xs"}),i("v-uni-text",[t._v("来源")])],1)],1)],1)})),1),i("uni-load-more",{attrs:{contentText:t.loadmoreText}})],1)},a=[]},dc28:function(t,e,i){"use strict";var n=i("03ac"),o=i.n(n);o.a}}]);